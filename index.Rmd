---
title: "COVID Health and Race Trends"
author: "Mitch Lueken"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    df_print: paged
---

```{css styling, include = FALSE}
body {
  background-color: #dce6f5
}

table {
  border: 1px solid black;
  border-collapse: collapse;
}

td {
  border: 1px solid black;
  padding: 4px;
  text-align: left;
}

th {
  background-color: #4CAF50;
  border: 1px solid black;
  color: white;
  padding: 4px;
  text-align: left;
}

tr {
  hover {background-color: #f5f5f5;
  nth-child(even) {
    background-color: #f2f2f2;
  }
}
```

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, error = FALSE, include = FALSE)

library(tidyverse)
library(kableExtra)
library(HelpersMG)
library(choroplethr)
library(choroplethrMaps)
library(dplyr)
library(ggplot2)
library(readxl)
library(haven)
library(htmltools)

# This function makes the ggplot maps play nice with the names of counties
source("./R/fipsCoercer.R")

# This function commits great crimes against strings and tibbles
# It reads a tibble, brute-forces the tibble into an html file and saves it
# The javascript sorting function behaves alphabetically, rather than numerically
source("./R/makeSortableHTMLTable.R")
```

```{r download}
# CDC State Race Data
if(!file.exists("./raw_data/Provisional_Death_Counts_for_Coronavirus_Disease__COVID-19___Weekly_State-Specific_Data_Updates.csv")) {
  wget(url = "https://data.cdc.gov/api/views/pj7m-y5uh/rows.csv", destfile = "./raw_data/Provisional_Death_Counts_for_Coronavirus_Disease__COVID-19___Weekly_State-Specific_Data_Updates.csv")
}

# CDC County Race Data
if(!file.exists("./raw_data/Provisional_COVID-19_Death_Counts_by_County_and_Race.csv")) {
  wget(url = "https://data.cdc.gov/api/views/k8wy-p9cg/rows.csv", destfile = "./raw_data/Provisional_COVID-19_Death_Counts_by_County_and_Race.csv")
}

# CDC Race and Age Data
if(!file.exists("./raw_data/Deaths_involving_coronavirus_disease_2019__COVID-19__by_race_and_Hispanic_origin_group_and_age__by_state.csv")) {
  wget(url = "https://data.cdc.gov/api/views/ks3g-spdg/rows.csv", destfile = "./raw_data/Deaths_involving_coronavirus_disease_2019__COVID-19__by_race_and_Hispanic_origin_group_and_age__by_state.csv")
}

# NY Population
if(!file.exists("./raw_data/NY.csv")) {
  wget(url = "https://www.census.gov/quickfacts/fact/csv/NY/PST045219",
     destfile = "./raw_data/NY.csv")
}

# Better Census Data (Race by Age for each state)
if(!file.exists("./raw_data/sc-est2019-alldata6.csv")) {
    wget(url = "https://www2.census.gov/programs-surveys/popest/tables/2010-2019/state/asrh/sc-est2019-alldata6.csv",
         destfile = "./raw_data/sc-est2019-alldata6.csv")
}

# BRFSS
if(!file.exists("./raw_data/LLCP2018.XPT")) {
  wget(url = "https://www.cdc.gov/brfss/annual_data/2018/files/LLCP2018XPT.zip", destfile = "./raw_data/LLCP2018XPT.zip")
  unzip("./raw_data/LLCP2018XPT.zip", exdir = "./raw_data")
  unlink("./raw_data/LLCP2018XPT.zip")
}
```

```{r tidyNewYorkData}
# This gives the overall proportion of the entire state of NY that is white, something not available in the CDC dataset
ny_pop <- read_csv("./raw_data/NY.csv") %>%
  select(Fact, `New York`) %>%
  filter(Fact == "White alone, not Hispanic or Latino, percent") %>%
  transmute(pop = as.numeric(substr(`New York`, 1, 4)))
```

```{r tidyCOVIDStateData}
# The dataset needs to be trimmed and compacted to be more useful
data <- read_csv("./raw_data/Provisional_Death_Counts_for_Coronavirus_Disease__COVID-19___Weekly_State-Specific_Data_Updates.csv") %>%
  select(State,
         Indicator,
         White = `Non-Hispanic White`,
         Black = `Non-Hispanic Black or African American`,
         Native = `Non-Hispanic American Indian or Alaska Native`,
         Asian = `Non-Hispanic Asian`,
         Hispanic = `Hispanic or Latino`,
         Other = Other) %>%
  filter(State != "United States" &
         Indicator %in% c("Count of COVID-19 deaths",
                          "Distribution of COVID-19 deaths (%)",
                          "Unweighted distribution of population (%)")) %>%
  mutate(White = replace_na(White, 0),
         Black = replace_na(Black, 0),
         Native = replace_na(Native, 0),
         Asian = replace_na(Asian, 0),
         Hispanic = replace_na(Hispanic, 0),
         Other = replace_na(Other, 0)) %>%
  mutate(`Non-White` = Black + Native + Asian + Hispanic + Other) %>%
  select(-c(Black, Native, Asian, Hispanic, Other)) %>%
  pivot_wider(names_from = "Indicator", values_from = c("White", "Non-White")) %>%
  rename(White_Deaths = `White_Count of COVID-19 deaths`,
         `Non-White_Deaths` = `Non-White_Count of COVID-19 deaths`,
         White_Dist = `White_Distribution of COVID-19 deaths (%)`,
         `Non-White_Dist` = `Non-White_Distribution of COVID-19 deaths (%)`,
         White_Pop = `White_Unweighted distribution of population (%)`,
         `Non-White_Pop` = `Non-White_Unweighted distribution of population (%)`)

# NY and NYC are separated, rather than NYC being a subset, so some trickery is required
ny <- filter(data, State == "New York")
nyc <- filter(data, State == "New York City")
ny$White_Pop = ny_pop[[1]]
ny$White_Deaths = ny$White_Deaths + nyc$White_Deaths
ny$`Non-White_Deaths` = ny$`Non-White_Deaths` + nyc$`Non-White_Deaths`
ny$White_Dist = 100.0 * ny$White_Deaths / (ny$White_Deaths + ny$`Non-White_Deaths`)
ny$`Non-White_Dist` = 100 - ny$White_Dist

#NY and NYC removed, replaced with their combination
filter(data, State != "New York" & State != "New York City") %>%
  bind_rows(ny) %>%
  write_csv("./output/cdc_state_covid_race_data.csv")

rm(ny, nyc)
```

```{r tidyCOVIDCountyData}
# The county dataset also needs tidying
read_csv("./raw_data/Provisional_COVID-19_Death_Counts_by_County_and_Race.csv") %>%
  select(fips = `FIPS Code`,
         Indicator,
         Deaths = `COVID-19 Deaths Total`,
         White = `Non-Hispanic White`,
         Black = `Non-Hispanic Black`,
         Native = `Non-Hispanic American Indian or Alaska Native`,
         Asian = `Non-Hispanic Asian`,
         Hispanic,
         Other) %>%
  filter(Indicator %in% c("Distribution of COVID-19 deaths (%)",
                          "Distribution of population (%)")) %>%
  mutate(White = replace_na(White, 0),
         Black = replace_na(Black, 0),
         Native = replace_na(Native, 0),
         Asian = replace_na(Asian, 0),
         Hispanic = replace_na(Hispanic, 0),
         Other = replace_na(Other, 0)) %>%
  mutate(`Non-White` = Black + Native + Asian + Hispanic + Other) %>%
  select(-c(Black, Native, Asian, Hispanic, Other)) %>%
  pivot_wider(names_from = "Indicator", values_from = c("White", "Non-White")) %>%
  rename(White_Dist = `White_Distribution of COVID-19 deaths (%)`,
         `Non-White_Dist` = `Non-White_Distribution of COVID-19 deaths (%)`,
         White_Pop = `White_Distribution of population (%)`,
         `Non-White_Pop` = `Non-White_Distribution of population (%)`) %>%
  write_csv("./output/cdc_county_covid_race_data.csv")
```

```{r tidyCensusAgeRaceData}
# Population breakdown by state by race by age

# Calculate the population by age for non-hispanic white
stateAgesWhite <- read_csv("./raw_data/sc-est2019-alldata6.csv") %>%
  filter(SEX == 0 & ORIGIN == 1 & RACE == 1) %>%
  select(DIVISION, NAME, AGE, POPESTIMATE2019)

white0 <- stateAgesWhite %>%
  filter(AGE == 0) %>%
  select(DIVISION, region = NAME, `Under 1 year` = POPESTIMATE2019) %>%
  distinct()

white1_4 <- stateAgesWhite %>%
  filter(AGE > 0 & AGE < 5) %>%
  group_by(NAME) %>%
  summarize(NAME, `1-4 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white5_14 <- stateAgesWhite %>%
  filter(AGE > 4 & AGE < 15) %>%
  group_by(NAME) %>%
  summarize(NAME, `5-14 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white15_24 <- stateAgesWhite %>%
  filter(AGE > 14 & AGE < 25) %>%
  group_by(NAME) %>%
  summarize(NAME, `15-24 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white25_34 <- stateAgesWhite %>%
  filter(AGE > 24 & AGE < 35) %>%
  group_by(NAME) %>%
  summarize(NAME, `25-34 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white35_44 <- stateAgesWhite %>%
  filter(AGE > 34 & AGE < 45) %>%
  group_by(NAME) %>%
  summarize(NAME, `35-44 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white45_54 <- stateAgesWhite %>%
  filter(AGE > 44 & AGE < 55) %>%
  group_by(NAME) %>%
  summarize(NAME, `45-54 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white55_64 <- stateAgesWhite %>%
  filter(AGE > 54 & AGE < 65) %>%
  group_by(NAME) %>%
  summarize(NAME, `55-64 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white65_74 <- stateAgesWhite %>%
  filter(AGE > 64 & AGE < 75) %>%
  group_by(NAME) %>%
  summarize(NAME, `65-74 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white75_84 <- stateAgesWhite %>%
  filter(AGE > 74 & AGE < 85) %>%
  group_by(NAME) %>%
  summarize(NAME, `75-84 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

ageRace1 <- left_join(white0, white1_4, by = "region") %>%
  left_join(white5_14, by = "region") %>%
  left_join(white15_24, by = "region") %>%
  left_join(white25_34, by = "region") %>%
  left_join(white35_44, by = "region") %>%
  left_join(white45_54, by = "region") %>%
  left_join(white55_64, by = "region") %>%
  left_join(white65_74, by = "region") %>%
  left_join(white75_84, by = "region")

# Calculate the population by age and race for anyone else
stateAgesNon <- read_csv("./raw_data/sc-est2019-alldata6.csv") %>%
  filter(SEX == 0 & (ORIGIN == 1 | ORIGIN == 2)) %>%
  select(DIVISION, NAME, ORIGIN, RACE, AGE, POPESTIMATE2019)

nonWhite0 <- stateAgesNon %>%
  filter(AGE == 0) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(DIVISION, NAME, `Under 1 year` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite1_4 <- stateAgesNon %>%
  filter(AGE > 0 & AGE < 5) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `1-4 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite5_14 <- stateAgesNon %>%
  filter(AGE > 4 & AGE < 15) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `5-14 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite15_24 <- stateAgesNon %>%
  filter(AGE > 14 & AGE < 25) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `15-24 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite25_34 <- stateAgesNon %>%
  filter(AGE > 24 & AGE < 35) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `25-34 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite35_44 <- stateAgesNon %>%
  filter(AGE > 34 & AGE < 45) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `35-44 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite45_54 <- stateAgesNon %>%
  filter(AGE > 44 & AGE < 55) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `45-54 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite55_64 <- stateAgesNon %>%
  filter(AGE > 54 & AGE < 65) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `55-64 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite65_74 <- stateAgesNon %>%
  filter(AGE > 64 & AGE < 75) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `65-74 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite75_84 <- stateAgesNon %>%
  filter(AGE > 74 & AGE < 85) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `75-84 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

ageRace2 <- left_join(nonWhite0, nonWhite1_4, by = "region") %>%
  left_join(nonWhite5_14, by = "region") %>%
  left_join(nonWhite15_24, by = "region") %>%
  left_join(nonWhite25_34, by = "region") %>%
  left_join(nonWhite35_44, by = "region") %>%
  left_join(nonWhite45_54, by = "region") %>%
  left_join(nonWhite55_64, by = "region") %>%
  left_join(nonWhite65_74, by = "region") %>%
  left_join(nonWhite75_84, by = "region")

# Combine everything
ageRace3 <- ageRace1 %>% pivot_longer(-c(DIVISION, region), names_to = "age", values_to = "Pop_White")
ageRace4 <- ageRace2 %>% pivot_longer(-c(DIVISION, region), names_to = "age", values_to = "Pop_Non-White")

left_join(ageRace3, ageRace4, by = c("DIVISION", "region", "age")) %>%
  mutate(region = tolower(region), `Prop_Non-White` = 100 * `Pop_Non-White` / (Pop_White + `Pop_Non-White`)) %>%
  write_csv("./output/census_state_age_race_data.csv")

rm(white0, white1_4, white5_14, white15_24, white25_34, white35_44, white45_54, white55_64, white65_74, white75_84)
rm(nonWhite0, nonWhite1_4, nonWhite5_14, nonWhite15_24, nonWhite25_34, nonWhite35_44, nonWhite45_54, nonWhite55_64, nonWhite65_74, nonWhite75_84)
rm(ageRace1, ageRace2, ageRace3, ageRace4)
rm(stateAgesWhite, stateAgesNon)
```

```{r tidyCOVIDAgeRaceData}
# Tidying the age and race dataset
data <- read_csv("./raw_data/Deaths_involving_coronavirus_disease_2019__COVID-19__by_race_and_Hispanic_origin_group_and_age__by_state.csv") %>%
  select(region = State, age = `Age group`, race = `Race and Hispanic Origin Group`, deaths = `COVID-19 Deaths`) %>%
  pivot_wider(names_from = race, values_from = deaths) %>%
  rename(White = `Non-Hispanic White`,
         Black = `Non-Hispanic Black`,
         Native = `Non-Hispanic American Indian or Alaska Native`,
         Asian = `Non-Hispanic Asian`,
         Hispanic = `Hispanic or Latino`) %>%
  mutate(White = replace_na(White, 0),
       Black = replace_na(Black, 0),
       Native = replace_na(Native, 0),
       Asian = replace_na(Asian, 0),
       Hispanic = replace_na(Hispanic, 0),
       Unknown = replace_na(Unknown, 0)) %>%
  mutate(`Non-White` = Black + Native + Asian + Hispanic + Unknown) %>%
  select(region, age, White, `Non-White`) %>%
  filter(region != "United States") %>%
  filter(region != "puerto rico") %>%
  mutate(region = tolower(region))

# NY and NYC are AGAIN separated, rather than subsetted
ny <- filter(data, region == "new york")
nyc <- filter(data, region == "new york city")
ny <- ny
ny$White <- ny$White + nyc$White
ny$`Non-White` <- ny$`Non-White` + nyc$`Non-White`

# Calculating the proportion of deaths by race and the ratio of prop_pop to prop_death, and avoiding math problems
filter(data, region != "new york" & region != "new york city") %>%
  bind_rows(ny) %>%
  right_join(read_csv("./output/census_state_age_race_data.csv"), by = c("region", "age")) %>%
  mutate(`Deaths_Non-White` = if_else(`Non-White` == 0 & White == 0,
                                      50.0,
                                      if_else(`Non-White` == 0 & White != 0,
                                              0.0,
                                              if_else(`Non-White` != 0 & White == 0,
                                                      100.0,
                                                      100 * `Non-White` / (`Non-White` + White))))) %>%
  mutate(Ratio = if_else(`Non-White` == 0 & White == 0,
                         1.0,
                         `Deaths_Non-White` / `Prop_Non-White`)) %>%
  mutate(`Census Region` = if_else(DIVISION == 1,
                                   "New England",
                                   if_else(DIVISION == 2,
                                           "Middle Atlantic (NY)",
                                           if_else(DIVISION == 3,
                                                   "East North Central (Midwest)",
                                                   if_else(DIVISION == 4,
                                                           "West North Central (Plains)",
                                                           if_else(DIVISION == 5,
                                                                   "South Atlantic (Carolinas)",
                                                                   if_else(DIVISION == 6,
                                                                           "East South Central (The South)",
                                                                           if_else(DIVISION == 7,
                                                                                   "West South Central (Tex)",
                                                                                   if_else(DIVISION == 8,
                                                                                           "Mountain (The West)",
                                                                                           "Pacific"))))))))) %>%
   mutate(ageNum = if_else(age == "Under 1 year",
                          0.5,
                          if_else(age == "1-4 years",
                                  2.5,
                                  if_else(age == "5-14 years",
                                          10,
                                          if_else(age == "15-24 years",
                                                  20,
                                                  if_else(age == "25-34 years",
                                                          30,
                                                          if_else(age == "35-44 years",
                                                                  40,
                                                                  if_else(age == "45-54 years",
                                                                          50,
                                                                          if_else(age == "55-64 years",
                                                                                  60,
                                                                                  if_else(age == "65-74 years",
                                                                                          70,
                                                                                          80)))))))))) %>%
write_csv("./output/cdc_state_covid_age_race_data.csv")

rm(ny, nyc)
```

```{r tidyBRFSSData}
data("state.regions")
select(state.regions, region, `_STATE` = fips.numeric) %>%
  left_join(read_xpt("./raw_data/LLCP2018.XPT"), by = "_STATE") %>%
  select(weight = `_LLCPWT`, #Statistical Raking Weight
      	 region, # State
      	 race = `_RACEG21`, #1 Non-Hispanic White, 2 Other, 9 NA
      	 bmi = `_BMI5`, #BMI; BMI * 100
      	 cost_doctor = MEDCOST, # Unable to see doctor for cost in year; 1 Yes, 2 No, 7/9 NA
      	 infarction = CVDINFR4, # Ever had heart attack; 1 Yes, 2 No, 7/9 NA
      	 stroke = CVDSTRK3, # Ever had stroke; 1 Yes, 2 No, 7/9 NA
      	 asthma = ASTHMA3, # Ever had asthma; 1 Yes, 2 No, 7/9 NA
      	 copd = CHCCOPD1, # Ever had COPD; 1 Yes, 2 No, 7/9 NA
      	 kidney = CHCKDNY1, # Ever had kidney disease; 1 Yes, 2 No, 7/9 NA
      	 brimley = DIABETE3, # Ever had diabetes; 1 Yes, 4 Prediabetes, 2/3 No, 7/9 NA
      	 smoker = SMOKE100, # Ever smoked at least 100 cigs; 1 Yes, 2 No, 7/9 NA
      	 flu = FLUSHOT6, # Flu shot in last year; 1 Yes, 2 No, 7/9 NA
      	 vax = PNEUVAC4 # Ever had pneumonia vaccine; 1 Yes, 2 No, 7/9 NA
  	) %>%
  write_csv("./output/BRFSS.csv")
```

---

## Introduction

Here go words about what is to follow.

\

---

\

## BRFSS Data

```{r manipulateBRFSSData}
BRFSS <- read_csv("./output/BRFSS.csv")

# Calculating Proportion of State that is not Non-Hispanic White
white <- group_by(BRFSS, region) %>%
  filter(race == 1) %>%
  summarize(whites = sum(weight))
other <- group_by(BRFSS, region) %>%
  filter(race == 2) %>%
  summarize(others = sum(weight))
prop_other <- left_join(white, other, by = "region") %>%
  mutate(prop_others = others / (whites + others)) %>%
  select(region, prop_others)
rm(white, other)

# Calculating Average BMI
average_bmi <- group_by(BRFSS, region) %>%
  filter(!is.na(bmi)) %>%
  summarize(avg_bmi = sum(weight * bmi) / (100 * sum(weight)))

# Calculating Proportion of overweight (including obese) population (BMI >= 25.00)
weight_over <- group_by(BRFSS, region) %>%
  filter(!is.na(bmi) & bmi >= 2500) %>%
  summarize(overweight = sum(weight))
weight_not_over <- group_by(BRFSS, region) %>%
  filter(!is.na(bmi) & bmi < 2500) %>%
  summarize(not_overweight = sum(weight))
prop_over <- left_join(weight_over, weight_not_over, by = "region") %>%
  mutate(prop_overweight = overweight / (overweight + not_overweight)) %>%
  select(region, prop_overweight)
rm(weight_over, weight_not_over)

# Calculating Proportion of obese population (BMI >= 30.00)
weight_ob <- group_by(BRFSS, region) %>%
  filter(!is.na(bmi) & bmi >= 3000) %>%
  summarize(obese = sum(weight))
weight_not_ob <- group_by(BRFSS, region) %>%
  filter(!is.na(bmi) & bmi < 3000) %>%
  summarize(not_obese = sum(weight))
prop_ob <- left_join(weight_ob, weight_not_ob, by = "region") %>%
  mutate(prop_obese = obese / (obese + not_obese)) %>%
  select(region, prop_obese)
rm(weight_ob, weight_not_ob)

# Calculating Proportion of State that has been unable to visit doctor because of cost
cost_doc_yes <- group_by(BRFSS, region) %>%
  filter(cost_doctor == 1) %>%
  summarize(cost_doctor_yes = sum(weight))
cost_doc_no <- group_by(BRFSS, region) %>%
  filter(cost_doctor == 2) %>%
  summarize(cost_doctor_no = sum(weight))
prop_cost_doc <- left_join(cost_doc_yes, cost_doc_no, by = "region") %>%
  mutate(prop_cost_doctor = cost_doctor_yes / (cost_doctor_yes + cost_doctor_no)) %>%
  select(region, prop_cost_doctor)
rm(cost_doc_yes, cost_doc_no)

# Calculating Proportion of State that has had a heart attack
infarc_yes <- group_by(BRFSS, region) %>%
  filter(infarction == 1) %>%
  summarize(infarction_yes = sum(weight))
infarc_no <- group_by(BRFSS, region) %>%
  filter(infarction == 2) %>%
  summarize(infarction_no = sum(weight))
prop_infarc <- left_join(infarc_yes, infarc_no, by = "region") %>%
  mutate(prop_infarction = infarction_yes / (infarction_yes + infarction_no)) %>%
  select(region, prop_infarction)
rm(infarc_yes, infarc_no)

# Calculating Proportion of State that has had a stroke
cva_yes <- group_by(BRFSS, region) %>%
  filter(stroke == 1) %>%
  summarize(stroke_yes = sum(weight))
cva_no <- group_by(BRFSS, region) %>%
  filter(stroke == 2) %>%
  summarize(stroke_no = sum(weight))
prop_cva <- left_join(cva_yes, cva_no, by = "region") %>%
  mutate(prop_stroke = stroke_yes / (stroke_yes + stroke_no)) %>%
  select(region, prop_stroke)
rm(cva_yes, cva_no)

# Calculating Proportion of State that has had asthma
atmen_yes <- group_by(BRFSS, region) %>%
  filter(asthma == 1) %>%
  summarize(asthma_yes = sum(weight))
atmen_no <- group_by(BRFSS, region) %>%
  filter(asthma == 2) %>%
  summarize(asthma_no = sum(weight))
prop_atmen <- left_join(atmen_yes, atmen_no, by = "region") %>%
  mutate(prop_asthma = asthma_yes / (asthma_yes + asthma_no)) %>%
  select(region, prop_asthma)
rm(atmen_yes, atmen_no)

# Calculating Proportion of State that has had COPD
lungs_yes <- group_by(BRFSS, region) %>%
  filter(copd == 1) %>%
  summarize(copd_yes = sum(weight))
lungs_no <- group_by(BRFSS, region) %>%
  filter(copd == 2) %>%
  summarize(copd_no = sum(weight))
prop_lungs <- left_join(lungs_yes, lungs_no, by = "region") %>%
  mutate(prop_copd = copd_yes / (copd_yes + copd_no)) %>%
  select(region, prop_copd)
rm(lungs_yes, lungs_no)

# Calculating Proportion of State that has had Chronic Kidney Disease
kid_yes <- group_by(BRFSS, region) %>%
  filter(kidney == 1) %>%
  summarize(kidney_yes = sum(weight))
kid_no <- group_by(BRFSS, region) %>%
  filter(kidney == 2) %>%
  summarize(kidney_no = sum(weight))
prop_kid <- left_join(kid_yes, kid_no, by = "region") %>%
  mutate(prop_kidney = kidney_yes / (kidney_yes + kidney_no)) %>%
  select(region, prop_kidney)
rm(kid_yes, kid_no)

# Calculating Proportion of State that has Diabetes (Excluding Gestational Diabetes) 1 4 23
beetus_yes <- group_by(BRFSS, region) %>%
  filter(brimley == 1) %>%
  summarize(diabetes_yes = sum(weight))
beetus_no <- group_by(BRFSS, region) %>%
  filter(brimley == 2 | brimley == 3 | brimley == 4) %>%
  summarize(diabetes_no = sum(weight))
beetus_pre <- group_by(BRFSS, region) %>%
  filter(brimley == 1 | brimley == 4) %>%
  summarize(prediabetes_yes = sum(weight))
beetus_none <- group_by(BRFSS, region) %>%
  filter(brimley == 2 | brimley == 3) %>%
  summarize(prediabetes_no = sum(weight))
prop_beetus <- left_join(beetus_yes, beetus_no, by = "region") %>%
  mutate(prop_diabetes = diabetes_yes / (diabetes_yes + diabetes_no)) %>%
  select(region, prop_diabetes)
prop_prebeetus <- left_join(beetus_pre, beetus_none, by = "region") %>%
  mutate(prop_prediabetes = prediabetes_yes / (prediabetes_yes + prediabetes_no)) %>%
  select(region, prop_prediabetes)
rm(beetus_yes, beetus_no, beetus_pre, beetus_none)

# Calculating Proportion of State that has ever smoked more than 100 Cigarettes
cig_yes <- group_by(BRFSS, region) %>%
  filter(smoker == 1) %>%
  summarize(smoker_yes = sum(weight))
cig_no <- group_by(BRFSS, region) %>%
  filter(smoker == 2) %>%
  summarize(smoker_no = sum(weight))
prop_cig <- left_join(cig_yes, cig_no, by = "region") %>%
  mutate(prop_smoker = smoker_yes / (smoker_yes + smoker_no)) %>%
  select(region, prop_smoker)
rm(cig_yes, cig_no)

# Calculating Proportion of State that got the flu shot in the last year
shot_yes <- group_by(BRFSS, region) %>%
  filter(flu == 1) %>%
  summarize(flu_yes = sum(weight))
shot_no <- group_by(BRFSS, region) %>%
  filter(flu == 2) %>%
  summarize(flu_no = sum(weight))
prop_shot <- left_join(shot_yes, shot_no, by = "region") %>%
  mutate(prop_flu = flu_yes / (flu_yes + flu_no)) %>%
  select(region, prop_flu)
rm(shot_yes, shot_no)

# Calculating Proportion of State that has been vaccinated against pneumonia
pneu_yes <- group_by(BRFSS, region) %>%
  filter(vax == 1) %>%
  summarize(vax_yes = sum(weight))
pneu_no <- group_by(BRFSS, region) %>%
  filter(vax == 2) %>%
  summarize(vax_no = sum(weight))
prop_pneu <- left_join(pneu_yes, pneu_no, by = "region") %>%
  mutate(prop_vax = vax_yes / (vax_yes + vax_no)) %>%
  select(region, prop_vax)
rm(pneu_yes, pneu_no)

read_csv("./raw_data/sc-est2019-alldata6.csv") %>%
  filter(ORIGIN == 0 & SEX == 0) %>%
  transmute(region = tolower(NAME), pop = POPESTIMATE2019) %>%
  group_by(region) %>%
  summarize(total_pop = sum(pop)) %>%
  left_join(read_csv("./output/cdc_state_covid_race_data.csv") %>% mutate(region = tolower(State)), by = "region") %>%
  mutate(deaths_per_100k = 100000.0 * (White_Deaths + `Non-White_Deaths`) / (total_pop)) %>%
  select(region, deaths_per_100k) %>%
  left_join(prop_other, by = "region") %>%
  left_join(average_bmi, by = "region") %>%
  left_join(prop_over, by = "region") %>%
  left_join(prop_ob, by = "region") %>%
  left_join(prop_beetus, by = "region") %>%
  left_join(prop_prebeetus, by = "region") %>%
  left_join(prop_cig, by = "region") %>%
  left_join(prop_atmen, by = "region") %>%
  left_join(prop_lungs, by = "region") %>%
  left_join(prop_infarc, by = "region") %>%
  left_join(prop_cva, by = "region") %>%
  left_join(prop_kid, by = "region") %>%
  left_join(prop_shot, by = "region") %>%
  left_join(prop_pneu, by = "region") %>%
  left_join(prop_cost_doc, by = "region") %>%
  write_csv("./output/state_health.csv") %>%
  filter(!is.na(deaths_per_100k)) %>%
  write_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  transmute(State = paste(toupper(substring(strsplit(region, " ")[[1]], 1, 1)), substring(strsplit(region, " ")[[1]], 2), sep = "", collapse = " "),
            `Deaths per 100,000 Population` = round(deaths_per_100k, 1),
            `Percent not Non-Hispanic White Only` = round(100.0 * prop_others, 2),
            `Mean BMI` = round(avg_bmi, 2),
            `Percent Overweight or Obese` = round(100.0 * prop_overweight, 2),
            `Percent Obese` = round(100.0 * prop_obese, 2),
            `Percent Diabetes or Prediabetes` = round(100.0 * prop_diabetes, 2),
            `Percent Prediabetes` = round(100.0 * prop_prediabetes, 2),
            `Percent Ever Smoked 100 Cigarettes` = round(100.0 * prop_smoker, 2),
            `Percent Asthma` = round(100.0 * prop_asthma, 2),
            `Percent COPD` = round(100.0 * prop_copd, 2),
            `Percent Heart Attack` = round(100.0 * prop_infarction, 2),
            `Percent Stroke` = round(100.0 * prop_stroke, 2),
            `Percent Kidney Disease` = round(100.0 * prop_kidney, 2),
            `Percent Flu Shot in Last Year` = round(100.0 * prop_flu, 2),
            `Percent Pneumonia Vaccine` = round(100.0 * prop_vax, 2),
            `Percent Can't Afford Doctor` = round(100.0 * prop_cost_doctor, 2)) %>%
  mutate(State = if_else(State == "District Of Columbia", "District of Columbia", State)) %>%
  ungroup() %>%
  select(-region) %>%
  write_csv("./output/state_health_no_na_trimmed.csv")
  
rm(prop_other, average_bmi, prop_over, prop_ob,  prop_beetus, prop_prebeetus, prop_cig, prop_atmen, prop_lungs, prop_infarc, prop_cva, prop_kid, prop_shot, prop_pneu, prop_cost_doc)
```

```{r tableStateHealthData, include = TRUE}
# This saves a table out of the trimmed health data, then spits it out as raw text like its markdown, creating an html table
makeSortableHTMLTable(read_csv("./output/state_health_no_na_trimmed.csv"), "state_health_no_na_trimmed_table")
htmltools::includeHTML("./output/state_health_no_na_trimmed_table.html")
```
\

Introduce the horrifying BRFSS data.

\

---

\

### Deaths and Race

```{r graphStateHealthPropOthers, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs Racial Makeup
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, prop_others)

ggplot(data, aes(x = data$prop_others, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

x

---

### Deaths and BMI

```{r graphStateHealthAvgBMI, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs Average BMI
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, avg_bmi)

ggplot(data, aes(x = data$avg_bmi, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

```{r graphStateHealthPropOver, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs Overweight Prevalence
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, prop_overweight)

ggplot(data, aes(x = data$prop_overweight, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

```{r graphStateHealthPropObese, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs Obesity Prevalence
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, prop_obese)

ggplot(data, aes(x = data$prop_obese, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

x

---

### Deaths and Diabetes

```{r graphStateHealthPropDiabetes, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs Diabetes Prevalence
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, prop_diabetes)

ggplot(data, aes(x = data$prop_diabetes, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

x

```{r graphStateHealthPropPrediabetes, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs Prediabetes Prevalence
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, prop_prediabetes)

ggplot(data, aes(x = data$prop_prediabetes, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

x

___

### Deaths and Lungs

```{r graphStateHealthPropSmoker, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs Smoking
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, prop_smoker)

ggplot(data, aes(x = data$prop_smoker, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

Smoking.

```{r graphStateHealthPropAsthma, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs Asthma Prevalence
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, prop_asthma)

ggplot(data, aes(x = data$prop_asthma, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

Asthma

```{r graphStateHealthPropCOPD, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs COPD Prevalence
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, prop_copd)

ggplot(data, aes(x = data$prop_copd, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

COPD

---

### Deaths and CVD

```{r graphStateHealthPropInfarction, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs Heart Attacks
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, prop_infarction)

ggplot(data, aes(x = data$prop_infarction, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

Infarction

```{r graphStateHealthPropStroke, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs Strokes
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, prop_stroke)

ggplot(data, aes(x = data$prop_stroke, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

Stroke

---

### Deaths and Kidney Disease

```{r graphStateHealthPropKidney, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs Chronic Kidney Disease
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, prop_kidney)

ggplot(data, aes(x = data$prop_kidney, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

CKD

---

### Deaths and Vaccinations

```{r graphStateHealthPropFlu, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs Flu Shots
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, prop_flu)

ggplot(data, aes(x = data$prop_flu, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

```{r graphStateHealthPropVax, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs Vaccination
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, prop_vax)

ggplot(data, aes(x = data$prop_vax, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

Flu and Pneumonia.

---

### Deaths and Healthcare Cost

```{r graphStateHealthPropCostDoctor, include = TRUE}
# A graph of per Capita COVID-19 Deaths vs Unaffordable Healthcare
data <- read_csv("./output/state_health_no_na.csv") %>%
  group_by(region) %>%
  select(deaths_per_100k, prop_cost_doctor)

ggplot(data, aes(x = data$prop_cost_doctor, y = data$deaths_per_100k, color = region)) + geom_point(size = 2) + theme_linedraw()
```

Doc Cost.

\

---

\

## Race Data

Brief intro into the racial data. Disclaimer about use of terminology ("not non-Hispanic White only" is not a feasible construct).

### Choropleths

```{r choroplethRacePopulation, include = TRUE}
# Map of State Non-White Pop Proportion
pop <- read_csv("./output/cdc_state_covid_race_data.csv") %>%
  transmute(region = tolower(State), value = `Non-White_Pop`) %>%
  StateChoropleth$new()
pop$title = "Proportion of Population that is not Non-Hispanic White Only"
pop$ggplot_scale = scale_fill_brewer(type = "seq", palette = 2, name = "Proportion of Population", drop = FALSE, na.value = "black")
pop$show_labels = FALSE
pop$render()
```

Comment on racial distribution map.

```{r choroplethRaceCOVID, include = TRUE}
# Map of State Non-White Distribution of COVID Deaths
prop <- read_csv("./output/cdc_state_covid_race_data.csv") %>%
  transmute(region = tolower(State), value = `Non-White_Dist`) %>%
  StateChoropleth$new()
prop$title = "Proportion of COVID Deaths from Population that is not Non-Hispanic White Only"
prop$ggplot_scale = scale_fill_brewer(type = "seq", palette = 8, name = "Proportion of Deaths", drop = FALSE, na.value = "black")
prop$show_labels = FALSE
prop$render()
```

Comment on COVID racial distribution map.

---

### Maps

```{r mapRatioState, include = TRUE}
# A fancier ggplot map

# This joins the state boundry map coords with the dataset, allowing for mapping in ggplot
states <- read_csv("./output/cdc_state_covid_race_data.csv") %>%
  transmute(region = tolower(State), value = `Non-White_Dist` / `Non-White_Pop`) %>%
  full_join(map_data("state"), by = "region")

# This plots the states, filling them in based on the Ratio
ggplot(states) +
  geom_polygon(aes(x = long,
                   y = lat,
                   fill = value,
                   group = group),
               color = "black",
               size = 0.25) +
  theme_linedraw() +
  expand_limits(x = states$long, y = states$lat) +
  scale_fill_gradient2(name = "Ratio",
                      low = "blue",
                      mid = "grey",
                      midpoint = 1.0,
                      high = "red",
                      na.value = "black") +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom") +
  xlab("") + ylab("") +
  labs(title = "Ratio of Proportion of COVID Deaths to Proportion of Population\nfor not Non-Hispanic White Only State Population") +
ggsave("./figures/ratio_state.png")
```

Far more meaningful comments on this map showing the real data. Meat of Racial Section.

```{r mapRatioCounty, include = TRUE}
# This is the same idea, but using the limited county-specific data

data <- read_csv("./output/cdc_county_covid_race_data.csv") %>%
  mutate(Ratio = `Non-White_Dist` / `Non-White_Pop`)

# This convoluted code smushes the different naming schema together, and mostly they work okay, if you ignore Virginia
data("county.regions")
mapData <- county.regions %>%
  transmute(fips = region, region = state.name, subregion = county.name) %>%
  fipsCoercer() %>%
  inner_join(map_data("county"), by = c("region", "subregion")) %>%
  full_join(data, by = "fips")

ggplot(mapData, aes(x = long,
                    y = lat,
                    group = group)) +
  geom_polygon(aes(fill = Ratio), color = NA) +
  theme_linedraw() +
  scale_fill_gradient2(name = "Ratio",
                      low = "blue",
                      mid = "grey",
                      high = "red",
                      midpoint = 1,
                      na.value = "black") +
  expand_limits(x = mapData$long, y = mapData$lat) +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom") +
  xlab("") + ylab("") +
  labs(title = "Ratio of Proportion of COVID Deaths to Proportion of Population\nfor not Non-Hispanic White Only County Population") +
  coord_map()
ggsave("./figures/ratio_county.png")
```

A note on the uselessness of this map.

---

### Graphs

Introduce the graphs to come.

**Here goes a picture of the Census Regions**

```{r plotCOVIDAgeRaceCensusRegion, include = TRUE}
# Plots Ratio by Census Region
read_csv("./output/cdc_state_covid_age_race_data.csv") %>%
  group_by(`Census Region`, ageNum) %>%
  summarize(ageNum, pop_avg = (sum(`Non-White`) / sum(White + `Non-White`)) / (sum(`Pop_Non-White`) / sum(`Pop_Non-White` + Pop_White))) %>%
  distinct() %>%
  mutate(pop_avg = replace_na(pop_avg, 1.0)) %>%
  ggplot(aes(x = ageNum, y = pop_avg, color = `Census Region`)) +
  geom_line(size = 2) +
  labs(title = "Ratio of Proportion of COVID Deaths to Proportion of Population\nfor not Non-Hispanic White Only Census Region Population",
       x = "Age",
       y = "Ratio") +
  theme_linedraw() +
  ylim(0, 4)
```

Comment on the differences between regions. Note that the line at 1.0 is because there were no deaths, not because they were actually equal. Note general trends in age data.

```{r plotCOVIDStates, include = TRUE}
# Plots Ratio by State, grouped by Census Region
read_csv("./output/cdc_state_covid_age_race_data.csv") %>%
  group_by(region, ageNum) %>%
  summarize(`Census Region`, pop_avg = (sum(`Non-White`) / sum(White + `Non-White`)) / (sum(`Pop_Non-White`) / sum(`Pop_Non-White` + Pop_White))) %>%
  mutate(pop_avg = replace_na(pop_avg, 1.0)) %>%
  ggplot(aes(x = ageNum, y = pop_avg, color = region)) +
  geom_line(size = 1.5) +
  labs(title = "Ratio of Proportion of COVID Deaths to Proportion of Population\nfor not Non-Hispanic White Only State Population\nBy 10-Year Age Group Midpoint Grouped by Census Region",
       x = "Age",
       y = "Ratio") +
  theme_linedraw() +
  facet_grid(`Census Region` ~ .)
```

Make this graph like fifty times taller. Then compare to previous, as it is simply a more granular version.

---

### Political Data

```{r tableCOVIDAgeState, include = TRUE}
# As a table
data("state.regions")

knitr::kable(read_csv("./raw_data/States-Governors.csv") %>%
  left_join(state.regions, by = c("State" = "abb")) %>%
  select(region, Gov_Male, Gov_Rep) %>%
  right_join(read_csv("./output/cdc_state_covid_age_race_data.csv"), by = "region") %>%
  group_by(region, age) %>%
  summarize(Gov_Male, Gov_Rep, pop_avg = (sum(`Non-White`) / sum(White + `Non-White`)) / (sum(`Pop_Non-White`) / sum(`Pop_Non-White` + Pop_White))) %>%
  mutate(pop_avg = replace_na(pop_avg, 1.0)) %>%
  pivot_wider(names_from = age, values_from = pop_avg) %>%
  mutate(`Governor Sex` = if_else(Gov_Male, "Male", "Female"),
         `Governor Party` = if_else(Gov_Rep, "Republican", "Democrat"),
         State = paste(toupper(substring(strsplit(region, " ")[[1]], 1, 1)), substring(strsplit(region, " ")[[1]], 2), sep = "", collapse = " ")) %>%
  mutate(State = if_else(State == "District Of Columbia", "District of Columbia", State)) %>%
  transmute(State,
            `Governor Party`,
            `Governor Sex`,
            `15-24 years` = round(`15-24 years`, 2),
            `25-34 years` = round(`25-34 years`, 2),
            `35-44 years` = round(`35-44 years`, 2),
            `45-54 years` = round(`45-54 years`, 2),
            `55-64 years` = round(`55-64 years`, 2),
            `65-74 years` = round(`65-74 years`, 2),
            `75-84 years` = round(`75-84 years`, 2)) %>%
  ungroup() %>%
  select(-region))
```

\

Here is a table giving the age breakdowns and governor info for each state. Note anything of interest, like the number of female governors, republican governors, and female republican governors.

```{r plotCOVIDGovernorSex, include = TRUE, fig.cap = "**Figure**"}
# By Governor Sex
read_csv("./raw_data/States-Governors.csv") %>%
  left_join(state.regions, by = c("State" = "abb")) %>%
  select(region, Gov_Male) %>%
  right_join(read_csv("./output/cdc_state_covid_age_race_data.csv"), by = "region") %>%
  group_by(ageNum, Gov_Male) %>%
  summarize(pop_avg = (sum(`Non-White`) / sum(White + `Non-White`)) / (sum(`Pop_Non-White`) / sum(`Pop_Non-White` + Pop_White))) %>%
  mutate(pop_avg = replace_na(pop_avg, 1.0)) %>%
  ggplot(aes(x = ageNum, y = pop_avg, color = Gov_Male)) +
  geom_line(size = 3) +
  labs(title = "Ratio of Proportion of COVID Deaths to Proportion of Population\nfor not Non-Hispanic White Only Population\nBy 10-Year Age Group Midpoint Grouped by Governor Sex",
       x = "Age",
       y = "Ratio") +
  scale_color_discrete(name = "Governor Sex",
                       labels = c("Female", "Male")) +
  theme_linedraw()
```

Note how bad this looks. It is because of Michigan and Kansas, and a little bit of Iowa. The other female-led states have far lower-than-average populations, and so do not affect this graph meaningfully. Male-led states are essentially a straight line through the average values.

```{r plotCOVIDGovernorParty, include = TRUE}
# By Governor Party
read_csv("./raw_data/States-Governors.csv") %>%
  left_join(state.regions, by = c("State" = "abb")) %>%
  select(region, Gov_Rep) %>%
  right_join(read_csv("./output/cdc_state_covid_age_race_data.csv"), by = "region") %>%
  group_by(ageNum, Gov_Rep) %>%
  summarize(pop_avg = (sum(`Non-White`) / sum(White + `Non-White`)) / (sum(`Pop_Non-White`) / sum(`Pop_Non-White` + Pop_White))) %>%
  mutate(pop_avg = replace_na(pop_avg, 1.0)) %>%
  ggplot(aes(x = ageNum, y = pop_avg, color = !Gov_Rep)) +
  geom_line(size = 3) +
  labs(title = "Ratio of Proportion of COVID Deaths to Proportion of Population\nfor not Non-Hispanic White Only Population\nBy 10-Year Age Group Midpoint Grouped by Governor Party",
       x = "Age",
       y = "Ratio") +
  scale_color_discrete(name = "Governor Party",
                       labels = c("Republican", "Democrat")) +
  theme_linedraw()
```

Note how there is no real difference in trend or value based on party. Speculate wildly about why.

\

---

\

## Misc

Here goes all the random little things to look into (Whole Foods, religion, etc.).

\

---

\

## Conclusions

Everything is fine. No bad things have or will happen.

\

---

\

## TODO

Download Census Region Map
Download GovInfo
Tables needs slight padding, some cell outlines