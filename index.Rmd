---
title: "COVID Health and Race Trends"
author: "Mitch Lueken"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    df_print: paged
---

<style>
  body {
    background-color: #dce6f5
  }
  
  table {
    border: 1px solid black;
    border-collapse: collapse;
  }
  
  td {
    border: 1px solid black;
    padding: 4px;
    text-align: left;
  }
  
  th {
    background-color: #4CAF50;
    border: 1px solid black;
    color: white;
    padding: 4px;
    text-align: left;
  }
  
  tr {
    hover {background-color: #f5f5f5;
    nth-child(even) {
      background-color: #f2f2f2;
    }
  }
</style>

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, error = FALSE, include = FALSE)

library(tidyverse)
library(kableExtra)
library(HelpersMG)
library(choroplethr)
library(choroplethrMaps)
library(dplyr)
library(ggplot2)
library(readxl)
library(haven)
library(htmltools)

# This function makes the ggplot maps play nice with the names of counties
source("./R/fipsCoercer.R")

# This function commits great crimes against strings and tibbles
# It reads a tibble, brute-forces the tibble into an html file and saves it
# The javascript sorting function behaves alphabetically, rather than numerically
source("./R/makeSortableHTMLTable.R")
```

```{r download}
# CDC State Race Data
if(!file.exists("./raw_data/Provisional_Death_Counts_for_Coronavirus_Disease__COVID-19___Weekly_State-Specific_Data_Updates.csv")) {
  wget(url = "https://data.cdc.gov/api/views/pj7m-y5uh/rows.csv", destfile = "./raw_data/Provisional_Death_Counts_for_Coronavirus_Disease__COVID-19___Weekly_State-Specific_Data_Updates.csv")
}

# CDC County Race Data
if(!file.exists("./raw_data/Provisional_COVID-19_Death_Counts_by_County_and_Race.csv")) {
  wget(url = "https://data.cdc.gov/api/views/k8wy-p9cg/rows.csv", destfile = "./raw_data/Provisional_COVID-19_Death_Counts_by_County_and_Race.csv")
}

# CDC Race and Age Data
if(!file.exists("./raw_data/Deaths_involving_coronavirus_disease_2019__COVID-19__by_race_and_Hispanic_origin_group_and_age__by_state.csv")) {
  wget(url = "https://data.cdc.gov/api/views/ks3g-spdg/rows.csv", destfile = "./raw_data/Deaths_involving_coronavirus_disease_2019__COVID-19__by_race_and_Hispanic_origin_group_and_age__by_state.csv")
}

# NY Population
if(!file.exists("./raw_data/NY.csv")) {
  wget(url = "https://www.census.gov/quickfacts/fact/csv/NY/PST045219",
     destfile = "./raw_data/NY.csv")
}

# Better Census Data (Race by Age for each state)
if(!file.exists("./raw_data/sc-est2019-alldata6.csv")) {
    wget(url = "https://www2.census.gov/programs-surveys/popest/tables/2010-2019/state/asrh/sc-est2019-alldata6.csv",
         destfile = "./raw_data/sc-est2019-alldata6.csv")
}

# BRFSS
if(!file.exists("./raw_data/LLCP2018.XPT")) {
  wget(url = "https://www.cdc.gov/brfss/annual_data/2018/files/LLCP2018XPT.zip", destfile = "./raw_data/LLCP2018XPT.zip")
  unzip("./raw_data/LLCP2018XPT.zip", exdir = "./raw_data")
  unlink("./raw_data/LLCP2018XPT.zip")
}

# Political Data
if(!file.exists("./raw_data/States-Governors.csv")) {
  wget(url = "https://github.com/luekenm/COVID-19/raw_data/States-Governors.csv", destfile = "./raw_data/States-Governors.csv")
}

# Metropolitan Statistical Areas
if(!file.exists("./figures/msa.gif")) {
  wget(url = "https://www2.census.gov/geo/maps/metroarea/us_wall/Feb2013/cbsa_us_0213_large.gif", destfile = "./figures/msa.gif", mode = "wb")
}

# Religious Data
if(!file.exists("./raw_data/Dataset - Pew Research Center 2014 Religious Landscape Study National Telephone Survey - Version 1.1 - December 1 2016.sav")) {
  wget(url = "https://www.pewforum.org/wp-content/uploads/sites/7/2016/12/Pew-Research-Center-2014-U.S.-Religious-Landscape-Study.zip", destfile = "./raw_data/Pew-Research-Center-2014-U.S.-Religious-Landscape-Study.zip")
  unzip("./raw_data/Pew-Research-Center-2014-U.S.-Religious-Landscape-Study.zip", exdir = "./raw_data")
  unlink("./raw_data/Pew-Research-Center-2014-U.S.-Religious-Landscape-Study.zip")
  unlink("./raw_data/Codebook - Pew Research Center 2014 Religious Landscape Study National Telephone Survey - Version 1.1 - December 1 2016.pdf")
}

# Whole Foods Data
if(!file.exists("./raw_data/States-WholeFoods.csv")) {
  wget(url = "https://github.com/luekenm/COVID-19/raw_data/States-WholeFoods.csv", destfile = "./raw_data/States-WholeFoods.csv")
}

# Confederate Monument Data
if(!file.exists("./raw_data/Whose Heritage SF - Symbol Type Count by State.csv")) {
  wget(url = "https://docs.google.com/spreadsheets/d/1W4H2qa2THM1ni53QYZftGob_k_Bf9HreFAtCERfjCIU/export?format=csv&id=1W4H2qa2THM1ni53QYZftGob_k_Bf9HreFAtCERfjCIU&gid=534759525", destfile = "./raw_data/Whose Heritage SF - Symbol Type Count by State.csv")
}
```

```{r tidyNewYorkData}
# This gives the overall proportion of the entire state of NY that is white, something not available in the CDC dataset
ny_pop <- read_csv("./raw_data/NY.csv") %>%
  select(Fact, `New York`) %>%
  filter(Fact == "White alone, not Hispanic or Latino, percent") %>%
  transmute(pop = as.numeric(substr(`New York`, 1, 4)))
```

```{r tidyCOVIDStateData}
# The dataset needs to be trimmed and compacted to be more useful
data <- read_csv("./raw_data/Provisional_Death_Counts_for_Coronavirus_Disease__COVID-19___Weekly_State-Specific_Data_Updates.csv") %>%
  select(State,
         Indicator,
         White = `Non-Hispanic White`,
         Black = `Non-Hispanic Black or African American`,
         Native = `Non-Hispanic American Indian or Alaska Native`,
         Asian = `Non-Hispanic Asian`,
         Hispanic = `Hispanic or Latino`,
         Other = Other) %>%
  filter(State != "United States" &
         Indicator %in% c("Count of COVID-19 deaths",
                          "Distribution of COVID-19 deaths (%)",
                          "Unweighted distribution of population (%)")) %>%
  mutate(White = replace_na(White, 0),
         Black = replace_na(Black, 0),
         Native = replace_na(Native, 0),
         Asian = replace_na(Asian, 0),
         Hispanic = replace_na(Hispanic, 0),
         Other = replace_na(Other, 0)) %>%
  mutate(`Non-White` = Black + Native + Asian + Hispanic + Other) %>% # This collapses the racial variable into a binary state
  select(-c(Black, Native, Asian, Hispanic, Other)) %>%
  pivot_wider(names_from = "Indicator", values_from = c("White", "Non-White")) %>%
  rename(White_Deaths = `White_Count of COVID-19 deaths`,
         `Non-White_Deaths` = `Non-White_Count of COVID-19 deaths`,
         White_Dist = `White_Distribution of COVID-19 deaths (%)`,
         `Non-White_Dist` = `Non-White_Distribution of COVID-19 deaths (%)`,
         White_Pop = `White_Unweighted distribution of population (%)`,
         `Non-White_Pop` = `Non-White_Unweighted distribution of population (%)`)

# NY and NYC are separated, rather than NYC being a subset, so some trickery is required
ny <- filter(data, State == "New York")
nyc <- filter(data, State == "New York City")
ny$White_Pop = ny_pop[[1]]
ny$White_Deaths = ny$White_Deaths + nyc$White_Deaths
ny$`Non-White_Deaths` = ny$`Non-White_Deaths` + nyc$`Non-White_Deaths`
ny$White_Dist = 100.0 * ny$White_Deaths / (ny$White_Deaths + ny$`Non-White_Deaths`)
ny$`Non-White_Dist` = 100 - ny$White_Dist

#NY and NYC removed, replaced with their combination
filter(data, State != "New York" & State != "New York City") %>%
  bind_rows(ny) %>%
  write_csv("./output/cdc_state_covid_race_data.csv")

rm(ny, nyc)
```

```{r tidyCOVIDCountyData}
# The county dataset also needs tidying
read_csv("./raw_data/Provisional_COVID-19_Death_Counts_by_County_and_Race.csv") %>%
  select(fips = `FIPS Code`,
         Indicator,
         Deaths = `COVID-19 Deaths Total`,
         White = `Non-Hispanic White`,
         Black = `Non-Hispanic Black`,
         Native = `Non-Hispanic American Indian or Alaska Native`,
         Asian = `Non-Hispanic Asian`,
         Hispanic,
         Other) %>%
  filter(Indicator %in% c("Distribution of COVID-19 deaths (%)",
                          "Distribution of population (%)")) %>%
  mutate(White = replace_na(White, 0),
         Black = replace_na(Black, 0),
         Native = replace_na(Native, 0),
         Asian = replace_na(Asian, 0),
         Hispanic = replace_na(Hispanic, 0),
         Other = replace_na(Other, 0)) %>%
  mutate(`Non-White` = Black + Native + Asian + Hispanic + Other) %>%
  select(-c(Black, Native, Asian, Hispanic, Other)) %>%
  pivot_wider(names_from = "Indicator", values_from = c("White", "Non-White")) %>%
  rename(White_Dist = `White_Distribution of COVID-19 deaths (%)`,
         `Non-White_Dist` = `Non-White_Distribution of COVID-19 deaths (%)`,
         White_Pop = `White_Distribution of population (%)`,
         `Non-White_Pop` = `Non-White_Distribution of population (%)`) %>%
  write_csv("./output/cdc_county_covid_race_data.csv")
```

```{r tidyCensusAgeRaceData}
# Population breakdown by state by race by age

# Calculate the population by age for non-hispanic white
stateAgesWhite <- read_csv("./raw_data/sc-est2019-alldata6.csv") %>%
  filter(SEX == 0 & ORIGIN == 1 & RACE == 1) %>%
  select(DIVISION, NAME, AGE, POPESTIMATE2019)

white0 <- stateAgesWhite %>%
  filter(AGE == 0) %>%
  select(DIVISION, region = NAME, `Under 1 year` = POPESTIMATE2019) %>%
  distinct()

white1_4 <- stateAgesWhite %>%
  filter(AGE > 0 & AGE < 5) %>%
  group_by(NAME) %>%
  summarize(NAME, `1-4 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white5_14 <- stateAgesWhite %>%
  filter(AGE > 4 & AGE < 15) %>%
  group_by(NAME) %>%
  summarize(NAME, `5-14 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white15_24 <- stateAgesWhite %>%
  filter(AGE > 14 & AGE < 25) %>%
  group_by(NAME) %>%
  summarize(NAME, `15-24 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white25_34 <- stateAgesWhite %>%
  filter(AGE > 24 & AGE < 35) %>%
  group_by(NAME) %>%
  summarize(NAME, `25-34 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white35_44 <- stateAgesWhite %>%
  filter(AGE > 34 & AGE < 45) %>%
  group_by(NAME) %>%
  summarize(NAME, `35-44 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white45_54 <- stateAgesWhite %>%
  filter(AGE > 44 & AGE < 55) %>%
  group_by(NAME) %>%
  summarize(NAME, `45-54 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white55_64 <- stateAgesWhite %>%
  filter(AGE > 54 & AGE < 65) %>%
  group_by(NAME) %>%
  summarize(NAME, `55-64 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white65_74 <- stateAgesWhite %>%
  filter(AGE > 64 & AGE < 75) %>%
  group_by(NAME) %>%
  summarize(NAME, `65-74 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

white75_84 <- stateAgesWhite %>%
  filter(AGE > 74 & AGE < 85) %>%
  group_by(NAME) %>%
  summarize(NAME, `75-84 years` = sum(POPESTIMATE2019)) %>%
  rename(region = NAME) %>%
  distinct()

ageRace1 <- left_join(white0, white1_4, by = "region") %>%
  left_join(white5_14, by = "region") %>%
  left_join(white15_24, by = "region") %>%
  left_join(white25_34, by = "region") %>%
  left_join(white35_44, by = "region") %>%
  left_join(white45_54, by = "region") %>%
  left_join(white55_64, by = "region") %>%
  left_join(white65_74, by = "region") %>%
  left_join(white75_84, by = "region")

# Calculate the population by age and race for anyone else
stateAgesNon <- read_csv("./raw_data/sc-est2019-alldata6.csv") %>%
  filter(SEX == 0 & (ORIGIN == 1 | ORIGIN == 2)) %>%
  select(DIVISION, NAME, ORIGIN, RACE, AGE, POPESTIMATE2019)

nonWhite0 <- stateAgesNon %>%
  filter(AGE == 0) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(DIVISION, NAME, `Under 1 year` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite1_4 <- stateAgesNon %>%
  filter(AGE > 0 & AGE < 5) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `1-4 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite5_14 <- stateAgesNon %>%
  filter(AGE > 4 & AGE < 15) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `5-14 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite15_24 <- stateAgesNon %>%
  filter(AGE > 14 & AGE < 25) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `15-24 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite25_34 <- stateAgesNon %>%
  filter(AGE > 24 & AGE < 35) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `25-34 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite35_44 <- stateAgesNon %>%
  filter(AGE > 34 & AGE < 45) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `35-44 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite45_54 <- stateAgesNon %>%
  filter(AGE > 44 & AGE < 55) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `45-54 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite55_64 <- stateAgesNon %>%
  filter(AGE > 54 & AGE < 65) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `55-64 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite65_74 <- stateAgesNon %>%
  filter(AGE > 64 & AGE < 75) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `65-74 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

nonWhite75_84 <- stateAgesNon %>%
  filter(AGE > 74 & AGE < 85) %>%
  filter(!(ORIGIN == 1 & RACE == 1)) %>%
  group_by(NAME) %>%
  summarize(NAME, `75-84 years` = sum(POPESTIMATE2019)) %>%
  distinct() %>%
  rename(region = NAME)

ageRace2 <- left_join(nonWhite0, nonWhite1_4, by = "region") %>%
  left_join(nonWhite5_14, by = "region") %>%
  left_join(nonWhite15_24, by = "region") %>%
  left_join(nonWhite25_34, by = "region") %>%
  left_join(nonWhite35_44, by = "region") %>%
  left_join(nonWhite45_54, by = "region") %>%
  left_join(nonWhite55_64, by = "region") %>%
  left_join(nonWhite65_74, by = "region") %>%
  left_join(nonWhite75_84, by = "region")

# Combine everything
ageRace3 <- ageRace1 %>% pivot_longer(-c(DIVISION, region), names_to = "age", values_to = "Pop_White")
ageRace4 <- ageRace2 %>% pivot_longer(-c(DIVISION, region), names_to = "age", values_to = "Pop_Non-White")

left_join(ageRace3, ageRace4, by = c("DIVISION", "region", "age")) %>%
  mutate(region = tolower(region), `Prop_Non-White` = 100 * `Pop_Non-White` / (Pop_White + `Pop_Non-White`)) %>%
  write_csv("./output/census_state_age_race_data.csv")

rm(white0, white1_4, white5_14, white15_24, white25_34, white35_44, white45_54, white55_64, white65_74, white75_84)
rm(nonWhite0, nonWhite1_4, nonWhite5_14, nonWhite15_24, nonWhite25_34, nonWhite35_44, nonWhite45_54, nonWhite55_64, nonWhite65_74, nonWhite75_84)
rm(ageRace1, ageRace2, ageRace3, ageRace4)
rm(stateAgesWhite, stateAgesNon)
```

```{r tidyCOVIDAgeRaceData}
# Tidying the age and race dataset
data <- read_csv("./raw_data/Deaths_involving_coronavirus_disease_2019__COVID-19__by_race_and_Hispanic_origin_group_and_age__by_state.csv") %>%
  select(region = State, age = `Age group`, race = `Race and Hispanic Origin Group`, deaths = `COVID-19 Deaths`) %>%
  pivot_wider(names_from = race, values_from = deaths) %>%
  rename(White = `Non-Hispanic White`,
         Black = `Non-Hispanic Black`,
         Native = `Non-Hispanic American Indian or Alaska Native`,
         Asian = `Non-Hispanic Asian`,
         Hispanic = `Hispanic or Latino`) %>%
  mutate(White = replace_na(White, 0),
       Black = replace_na(Black, 0),
       Native = replace_na(Native, 0),
       Asian = replace_na(Asian, 0),
       Hispanic = replace_na(Hispanic, 0),
       Unknown = replace_na(Unknown, 0)) %>%
  mutate(`Non-White` = Black + Native + Asian + Hispanic + Unknown) %>%
  select(region, age, White, `Non-White`) %>%
  filter(region != "United States") %>%
  filter(region != "puerto rico") %>%
  mutate(region = tolower(region))

# NY and NYC are AGAIN separated, rather than subsetted
ny <- filter(data, region == "new york")
nyc <- filter(data, region == "new york city")
ny <- ny
ny$White <- ny$White + nyc$White
ny$`Non-White` <- ny$`Non-White` + nyc$`Non-White`

# Calculating the proportion of deaths by race and the ratio of prop_pop to prop_death, and avoiding math problems
filter(data, region != "new york" & region != "new york city") %>%
  bind_rows(ny) %>%
  right_join(read_csv("./output/census_state_age_race_data.csv"), by = c("region", "age")) %>%
  mutate(`Deaths_Non-White` = if_else(`Non-White` == 0 & White == 0,
                                      50.0,
                                      if_else(`Non-White` == 0 & White != 0,
                                              0.0,
                                              if_else(`Non-White` != 0 & White == 0,
                                                      100.0,
                                                      100 * `Non-White` / (`Non-White` + White))))) %>%
  mutate(Ratio = if_else(`Non-White` == 0 & White == 0,
                         1.0,
                         `Deaths_Non-White` / `Prop_Non-White`)) %>%
  mutate(`Census Region` = if_else(DIVISION == 1,
                                   "New England",
                                   if_else(DIVISION == 2,
                                           "Middle Atlantic (NY)",
                                           if_else(DIVISION == 3,
                                                   "East North Central (Midwest)",
                                                   if_else(DIVISION == 4,
                                                           "West North Central (Plains)",
                                                           if_else(DIVISION == 5,
                                                                   "South Atlantic (Carolinas)",
                                                                   if_else(DIVISION == 6,
                                                                           "East South Central (The South)",
                                                                           if_else(DIVISION == 7,
                                                                                   "West South Central (Tex)",
                                                                                   if_else(DIVISION == 8,
                                                                                           "Mountain (The West)",
                                                                                           "Pacific"))))))))) %>%
   mutate(ageNum = if_else(age == "Under 1 year",
                          0.5,
                          if_else(age == "1-4 years",
                                  2.5,
                                  if_else(age == "5-14 years",
                                          10,
                                          if_else(age == "15-24 years",
                                                  20,
                                                  if_else(age == "25-34 years",
                                                          30,
                                                          if_else(age == "35-44 years",
                                                                  40,
                                                                  if_else(age == "45-54 years",
                                                                          50,
                                                                          if_else(age == "55-64 years",
                                                                                  60,
                                                                                  if_else(age == "65-74 years",
                                                                                          70,
                                                                                          80)))))))))) %>%
write_csv("./output/cdc_state_covid_age_race_data.csv")

rm(ny, nyc)
```

---

## Introduction

This report is a data analysis investigation into racial disparity in deaths from COVID-19 in the United States.
NOTE: Throughout the report the population is separated into two groups, "non-Hispanic White only", and "not Non-Hispanic White only", based on Census categories. For lack of a more feasible racially-sensitive construct, these will be referred to as "White" and "non-White", respectively. Any analyses including "Hispanic Whites" in "White", or not limiting to "White only", or using any other racial groupings, could reach different, equally-valid conclusions.

\

---

\

## Race Data

The data on population and racial breakdowns by states come from the Census. The [Annual State Resident Population Estimates for 6 Race Groups (5 Race Alone Groups and Two or More Races) by Age, Sex, and Hispanic Origin](https://www2.census.gov/programs-surveys/popest/technical-documentation/file-layouts/2010-2019/sc-est2019-alldata6.pdf) document from 2020 gives the estimates as of 2020-07-01, the most recent publicly available figures.

\

The data on COVID deaths by race, state, and age, come from the [Provisional Death Counts for Coronavirus Disease (COVID-19): Weekly State-Specific Data Updates](https://data.cdc.gov/NCHS/Provisional-Death-Counts-for-Coronavirus-Disease-C/pj7m-y5uh), which is produced by the National Center for Health Statistics division of the CDC, using data from the National Vital Statistics System.

\

Data is absent for Vermont, Montana, Wyoming, Alaska, and Hawaii.

### Maps

```{r choroplethRacePopulation, include = TRUE, fig.cap = "**Figure 1:** Racial Map of the United States"}
# Map of State Non-White Pop Proportion
pop <- read_csv("./output/cdc_state_covid_race_data.csv") %>%
  transmute(region = tolower(State), value = `Non-White_Pop`) %>%
  StateChoropleth$new()
pop$title = "Proportion of Population that is non-White"
pop$ggplot_scale = scale_fill_brewer(type = "seq", palette = 2, name = "Proportion of Population", drop = FALSE, na.value = "black")
pop$show_labels = FALSE
pop$render()
```

Figure 1 shows the concentration of non-White populations as a percentage of total population. Populations of note include: the Black population in the South and Chicago and Detroit, the large Hispanic population in the Southwest and Florida, and the noticeable populations of immigrants on the Pacific and North Atlantic coasts (and especially near New York City). The rest of the West, Midwest, and New England is noticeably lacking in non-White population except for in major urban areas.

```{r choroplethRaceCOVID, include = TRUE, fig.cap = "**Figure 2:** Non-White COVID Deaths as proportion of total COVID Deaths in the United States"}
# Map of State Non-White Distribution of COVID Deaths
prop <- read_csv("./output/cdc_state_covid_race_data.csv") %>%
  transmute(region = tolower(State), value = `Non-White_Dist`) %>%
  StateChoropleth$new()
prop$title = "Proportion of COVID Deaths from non-White Population"
prop$ggplot_scale = scale_fill_brewer(type = "seq", palette = 8, name = "Proportion of Deaths", drop = FALSE, na.value = "black")
prop$show_labels = FALSE
prop$render()
```

Figure 2 shows the percentage of COVID deaths in each state that occured within the non-White population. *Ceteris paribus*, this map should be roughly identical to figure 1. To meaningfully quantify the differences between figures 1 and 2, a new measure, the **Racial Disparity Index (RDI)** is introduced. The RDI is the ratio of "proportion of COVID deaths from among the non-White population" to "the proportion of the population that is non-White". If deaths were equally distributed between racial groups, the RDI would be near 1. A value at or near zero indicates deaths occurred almost exclusively among the White population. A value of 2 indicates that twice as many deaths as expected occurred among the non-White population. The RDI is an imperfect *ad hoc* measure, but it can help give a simplified, intuitive sense of the racial disparity in COVID deaths.

```{r mapRatioState, include = TRUE, fig.cap = "**Figure 3:** A map of the Racial Disparity Index for the United States"}
# A fancier ggplot map

# This joins the state boundry map coords with the dataset, allowing for mapping in ggplot
states <- read_csv("./output/cdc_state_covid_race_data.csv") %>%
  transmute(region = tolower(State), value = `Non-White_Dist` / `Non-White_Pop`) %>%
  full_join(map_data("state"), by = "region")

# This plots the states, filling them in based on the Ratio
ggplot(states) +
  geom_polygon(aes(x = long,
                   y = lat,
                   fill = value,
                   group = group),
               color = "black",
               size = 0.25) +
  theme_void() +
  expand_limits(x = states$long, y = states$lat) +
  scale_fill_gradient2(name = "RDI",
                      low = "blue",
                      mid = "grey",
                      midpoint = 1.0,
                      high = "red",
                      na.value = "black") +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom") +
  xlab("") + ylab("") +
  labs(title = "Ratio of Proportion of COVID Deaths to Proportion of Population\nfor non-White Population") +
ggsave("./figures/ratio_state.png")
```

As indicated in Figure 3, the RDI is low in a few states, somewhat elevated in most states, and extremely high in some states.

\

Those states with the lowest RDIs (West Virginia, Maine, and New Hampshire) are the least diverse states in the nation. They are also among the states with the fewest overall deaths; none has more than a few hundred COVID deaths total. This combination of factors has led them to not experience a single reported non-White COVID death.

\

Those states with the highest RDIs include New York, Wisconsin, Utah, Michigan, and Missouri.

```{r mapRatioCountyMichigan, include = TRUE,  fig.cap = "**Figure 4:** A map of the Racial Disparity Index for Michigan"}
# This is the same idea, but using the limited county-specific data

data <- read_csv("./output/cdc_county_covid_race_data.csv") %>%
  mutate(Ratio = `Non-White_Dist` / `Non-White_Pop`)

# This convoluted code smushes the different naming schema together, and mostly they work okay, if you ignore Virginia
data("county.regions")
mapData <- county.regions %>%
  transmute(fips = region, region = state.name, subregion = county.name) %>%
  fipsCoercer() %>%
  inner_join(map_data("county"), by = c("region", "subregion")) %>%
  full_join(data, by = "fips")

ggplot(filter(mapData, region == "michigan"), aes(x = long,
                    y = lat,
                    group = group)) +
  geom_polygon(aes(fill = Ratio), color = NA) +
  theme_void() +
  scale_fill_gradient2(name = "RDI",
                      low = "blue",
                      mid = "grey",
                      high = "red",
                      midpoint = 1,
                      na.value = "black") +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom") +
  xlab("") + ylab("") +
  labs(title = "Ratio of Proportion of COVID Deaths to Proportion of Population\nfor non-White Population in Michigan") +
  coord_map()
ggsave("./figures/ratio_county_mi.png")
```

```{r mapRatioCountyNewYork, include = TRUE, fig.cap = "**Figure 5:** A map of the Racial Disparity Index for New York"}
ggplot(filter(mapData, region == "new york"), aes(x = long,
                    y = lat,
                    group = group)) +
  geom_polygon(aes(fill = Ratio), color = NA) +
  theme_void() +
  scale_fill_gradient2(name = "RDI",
                      low = "blue",
                      mid = "grey",
                      high = "red",
                      midpoint = 1,
                      na.value = "black") +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom") +
  xlab("") + ylab("") +
  labs(title = "Ratio of Proportion of COVID Deaths to Proportion of Population\nfor non-White Population in New York") +
  coord_map()
ggsave("./figures/ratio_county_ny.png")
```

For those worst states, the RDI seems to be worst in bigger cities like New York City, Detroit, Flint, and Grand Rapids (figures 4 and 5).

\

What did we learn here?

---

### Age Differences

The RDI varies somewhat by age bracket. The RDI for each age bracket was calculated for each Census Region (see figure 6 for a map of Census Regions).

**Here goes a picture of the Census Regions**

Figure 7 shows the differences and trends in age-based RDI for the different Census Regions. NOTE: The figure does not average by state values, but across the entire region, so larger states are more influential.

```{r plotCOVIDAgeRaceCensusRegion, include = TRUE, fig.cap = "**Figure 7:** RDI for each Census Region plotted by age bracket midpoint"}
# Plots Ratio by Census Region
read_csv("./output/cdc_state_covid_age_race_data.csv") %>%
  group_by(`Census Region`, ageNum) %>%
  summarize(ageNum, pop_avg = (sum(`Non-White`) / sum(White + `Non-White`)) / (sum(`Pop_Non-White`) / sum(`Pop_Non-White` + Pop_White))) %>%
  distinct() %>%
  mutate(pop_avg = replace_na(pop_avg, 1.0)) %>%
  ggplot(aes(x = ageNum, y = pop_avg, color = `Census Region`)) +
  geom_line(size = 2) +
  labs(title = "Ratio of Proportion of COVID Deaths to Proportion of Population\nfor non-White Population by Age and Census Region",
       x = "Age Bracket Midpoint",
       y = "RDI") +
  theme_linedraw() +
  ylim(0, 4)
```

The horizontal line at 1 is because there were no reported COVID deaths at all for that age group, not because of any actual racial parity. For all regions the general trend was a high, relatively stable RDI with a slight decrease toward parity with increasing age.

```{r plotCOVIDStates, include = TRUE, fig.cap=""}
# Plots Ratio by State, grouped by Census Region
read_csv("./output/cdc_state_covid_age_race_data.csv") %>%
  group_by(region, ageNum) %>%
  summarize(`Census Region`, pop_avg = (sum(`Non-White`) / sum(White + `Non-White`)) / (sum(`Pop_Non-White`) / sum(`Pop_Non-White` + Pop_White))) %>%
  mutate(pop_avg = replace_na(pop_avg, 1.0)) %>%
  ggplot(aes(x = ageNum, y = pop_avg, color = region)) +
  geom_line(size = 1.5) +
  labs(title = "Ratio of Proportion of COVID Deaths to Proportion of Population\nfor non-White Population\nby Age and Census Region",
       x = "Age Bracket Midpoint",
       y = "RDI") +
  theme_linedraw() +
  facet_grid(`Census Region` ~ .)
```

Make this graph like fifty times taller. Then compare to previous, as it is simply a more granular version.

---

### Political Data

```{r tableCOVIDAgeState, include = TRUE, fig.cap = "**Table 1:** Age-Based RDI and Political Data by State"}
# As a table
data("state.regions")

read_csv("./raw_data/States-Governors.csv") %>%
  left_join(state.regions, by = c("State" = "abb")) %>%
  select(region, Gov_Male, Gov_Rep) %>%
  right_join(read_csv("./output/cdc_state_covid_age_race_data.csv"), by = "region") %>%
  group_by(region, age) %>%
  summarize(Gov_Male, Gov_Rep, pop_avg = (sum(`Non-White`) / sum(White + `Non-White`)) / (sum(`Pop_Non-White`) / sum(`Pop_Non-White` + Pop_White))) %>%
  mutate(pop_avg = replace_na(pop_avg, 1.0)) %>%
  pivot_wider(names_from = age, values_from = pop_avg) %>%
  mutate(`Governor Sex` = if_else(Gov_Male, "Male", "Female"),
         `Governor Party` = if_else(Gov_Rep, "Republican", "Democrat"),
         State = paste(toupper(substring(strsplit(region, " ")[[1]], 1, 1)), substring(strsplit(region, " ")[[1]], 2), sep = "", collapse = " ")) %>%
  mutate(State = if_else(State == "District Of Columbia", "District of Columbia", State)) %>%
  transmute(State,
            `Governor Party`,
            `Governor Sex`,
            `15-24 years` = round(`15-24 years`, 2),
            `25-34 years` = round(`25-34 years`, 2),
            `35-44 years` = round(`35-44 years`, 2),
            `45-54 years` = round(`45-54 years`, 2),
            `55-64 years` = round(`55-64 years`, 2),
            `65-74 years` = round(`65-74 years`, 2),
            `75-84 years` = round(`75-84 years`, 2)) %>%
  ungroup() %>%
  select(-region) %>%
  write_csv("./output/state_data.csv")

# Mutate to string to stop trailing zeroes from being trimmed in html
read_csv("./output/state_data.csv") %>%
  mutate_all(as.character) %>%
  mutate(`15-24 years` = if_else(nchar(`15-24 years`) == 1, paste(`15-24 years`, ".00", sep = ""), `15-24 years`)) %>%
  mutate(`25-34 years` = if_else(nchar(`25-34 years`) == 1, paste(`25-34 years`, ".00", sep = ""), `25-34 years`)) %>%
  mutate(`35-44 years` = if_else(nchar(`35-44 years`) == 1, paste(`35-44 years`, ".00", sep = ""), `35-44 years`)) %>%
  mutate(`45-54 years` = if_else(nchar(`45-54 years`) == 1, paste(`45-54 years`, ".00", sep = ""), `45-54 years`)) %>%
  mutate(`55-64 years` = if_else(nchar(`55-64 years`) == 1, paste(`55-64 years`, ".00", sep = ""), `55-64 years`)) %>%
  mutate(`65-74 years` = if_else(nchar(`65-74 years`) == 1, paste(`65-74 years`, ".00", sep = ""), `65-74 years`)) %>%
  mutate(`75-84 years` = if_else(nchar(`75-84 years`) == 1, paste(`75-84 years`, ".00", sep = ""), `75-84 years`)) %>%
  mutate(`15-24 years` = if_else(nchar(`15-24 years`) == 3, paste(`15-24 years`, "0", sep = ""), `15-24 years`)) %>%
  mutate(`25-34 years` = if_else(nchar(`25-34 years`) == 3, paste(`25-34 years`, "0", sep = ""), `25-34 years`)) %>%
  mutate(`35-44 years` = if_else(nchar(`35-44 years`) == 3, paste(`35-44 years`, "0", sep = ""), `35-44 years`)) %>%
  mutate(`45-54 years` = if_else(nchar(`45-54 years`) == 3, paste(`45-54 years`, "0", sep = ""), `45-54 years`)) %>%
  mutate(`55-64 years` = if_else(nchar(`55-64 years`) == 3, paste(`55-64 years`, "0", sep = ""), `55-64 years`)) %>%
  mutate(`65-74 years` = if_else(nchar(`65-74 years`) == 3, paste(`65-74 years`, "0", sep = ""), `65-74 years`)) %>%
  mutate(`75-84 years` = if_else(nchar(`75-84 years`) == 3, paste(`75-84 years`, "0", sep = ""), `75-84 years`)) %>%
  makeSortableHTMLTable("state_data_table") # Allows each column to be sorted, shoves data into html table file

htmltools::includeHTML("./output/state_data_table.html") # Pastes html table into Rmd
```

\

Table 1 gives the RDI age breakdowns and Governor info for each state. Figures 8 and 9 show that information plotted by Governor sex and party, respectively. The female-led states with worse RDIs (Michigan, Kansas, Iowa) had higher populations, leading to the **significantly?** increased RDI averages (see table 2). For both male-led states and states of either party (regardless of Governor sex), the RDIs were approximately 2 for all ages with reported COVID deaths. As of yet, the party of the Governor appears to make no significant difference (see table 3) in racial disparity in COVID deaths. Whether this is surprising or not is left as an exercise to the reader.

```{r plotCOVIDGovernorSex, include = TRUE, fig.cap = "**Figure**"}
# By Governor Sex
read_csv("./raw_data/States-Governors.csv") %>%
  left_join(state.regions, by = c("State" = "abb")) %>%
  select(region, Gov_Male) %>%
  right_join(read_csv("./output/cdc_state_covid_age_race_data.csv"), by = "region") %>%
  group_by(ageNum, Gov_Male) %>%
  summarize(pop_avg = (sum(`Non-White`) / sum(White + `Non-White`)) / (sum(`Pop_Non-White`) / sum(`Pop_Non-White` + Pop_White))) %>%
  mutate(pop_avg = replace_na(pop_avg, 1.0)) %>%
  ggplot(aes(x = ageNum, y = pop_avg, color = Gov_Male)) +
  geom_line(size = 3) +
  labs(title = "Ratio of Proportion of COVID Deaths to Proportion of Population\nfor non-White Population\nby Age Group and Governor Sex",
       x = "Age",
       y = "RDI") +
  scale_color_discrete(name = "Governor Sex",
                       labels = c("Female", "Male")) +
  theme_linedraw()
```

```{r plotCOVIDGovernorParty, include = TRUE, fig.cap = "**Figure**"}
# By Governor Party
read_csv("./raw_data/States-Governors.csv") %>%
  left_join(state.regions, by = c("State" = "abb")) %>%
  select(region, Gov_Rep) %>%
  right_join(read_csv("./output/cdc_state_covid_age_race_data.csv"), by = "region") %>%
  group_by(ageNum, Gov_Rep) %>%
  summarize(pop_avg = (sum(`Non-White`) / sum(White + `Non-White`)) / (sum(`Pop_Non-White`) / sum(`Pop_Non-White` + Pop_White))) %>%
  mutate(pop_avg = replace_na(pop_avg, 1.0)) %>%
  ggplot(aes(x = ageNum, y = pop_avg, color = !Gov_Rep)) +
  geom_line(size = 3) +
  labs(title = "Ratio of Proportion of COVID Deaths to Proportion of Population\nfor non-White Population\nby Age Group and Governor Party",
       x = "Age",
       y = "RDI") +
  scale_color_discrete(name = "Governor Party",
                       labels = c("Republican", "Democrat")) +
  theme_linedraw()
```

\

```{r table2}
# ANOVA sex
```

\

```{r table3}
# ANOVA party
```

\

---

\

## Health Data

```{r tidyBRFSSData}
data("state.regions")
select(state.regions, region, `_STATE` = fips.numeric) %>%
  left_join(read_xpt("./raw_data/LLCP2018.XPT"), by = "_STATE") %>%
  select(weight = `_LLCPWT`, #Statistical Raking Weight
      	 region, # State
      	 race = `_RACEG21`, #1 Non-Hispanic White Onlly, 2 Other, 9 NA
      	 metro = `_METSTAT`, # In metro county; 1 yes, 2 No
      	 urban = MSCODE, # 1/2 in metro or metro county, 3/5 suburban/rural
      	 vax = PNEUVAC4, # Ever had pneumonia vaccine; 1 Yes, 2 No, 7/9 NA
         asthma = ASTHNOW, # Have asthma now; 1 Yes, 2 No, 7/9 NA
         age = `_AGEG5YR` 
  	) %>%
  write_csv("./output/BRFSS.csv")
```

```{r manipulateBRFSSData}
BRFSS <- read_csv("./output/BRFSS.csv") %>%
# Splitting the BRFSS data by age bracket, with some abuse of good statistical practice, but only a little
  mutate(age = if_else(age == 2 | age == 3, "25-34 years",
                       if_else(age == 4 | age == 5, "35-44 years",
                               if_else(age == 6 | age == 7, "45-54 years",
                                       if_else(age == 8 | age == 9, "55-64 years",
                                               if_else(age == 10 | age == 11, "65-74 years",
                                                       if_else(age == 12 | age == 13, "75-84 years",
                                                               "NA")))))),
# Simplifying race variable
         isWhite = if_else(race == 1, TRUE,
                        if_else(race == 2, FALSE,
                                NA))) %>%
  filter(!is.na(isWhite)) %>%
  filter(age != "NA")

# Calculating Proportion of State that is in metro region
met_yes <- group_by(BRFSS, region, age, isWhite) %>%
  filter(metro == 1) %>%
  summarize(metro_yes = sum(weight))
met_no <- group_by(BRFSS, region, age, isWhite) %>%
  filter(metro == 2) %>%
  summarize(metro_no = sum(weight))
prop_met <- left_join(met_yes, met_no, by = c("region", "age", "isWhite")) %>%
  mutate(prop_metro = metro_yes / (metro_yes + metro_no)) %>%
  select(region, age, isWhite, prop_metro)
rm(met_yes, met_no)

# Calculating Proportion of State that is in metro region, excluding suburbs
urb_yes <- group_by(BRFSS, region, age, isWhite) %>%
  filter(urban == 1 | urban == 2) %>%
  summarize(urban_yes = sum(weight))
urb_no <- group_by(BRFSS, region, age, isWhite) %>%
  filter(urban == 3 | urban == 5) %>%
  summarize(urban_no = sum(weight))
prop_urb <- left_join(urb_yes, urb_no, by = c("region", "age", "isWhite")) %>%
  mutate(prop_urban = urban_yes / (urban_yes + urban_no)) %>%
  select(region, age, isWhite, prop_urban)
rm(urb_yes, urb_no)

# Calculating Proportion of State that has been vaccinated against pneumonia
pneu_yes <- group_by(BRFSS, region, age, isWhite) %>%
  filter(vax == 1) %>%
  summarize(vax_yes = sum(weight))
pneu_no <- group_by(BRFSS, region, age, isWhite) %>%
  filter(vax == 2) %>%
  summarize(vax_no = sum(weight))
prop_pneu <- left_join(pneu_yes, pneu_no, by = c("region", "age", "isWhite")) %>%
  mutate(prop_vax = vax_yes / (vax_yes + vax_no)) %>%
  select(region, age, isWhite, prop_vax)
rm(pneu_yes, pneu_no)

# Calculating Proportion of State that has asthma
as_yes <- group_by(BRFSS, region, age, isWhite) %>%
  filter(asthma == 1) %>%
  summarize(asthma_yes = sum(weight))
as_no <- group_by(BRFSS, region, age, isWhite) %>%
  filter(asthma == 2) %>%
  summarize(asthma_no = sum(weight))
prop_as <- left_join(as_yes, as_no, by = c("region", "age", "isWhite")) %>%
  mutate(prop_asthma = asthma_yes / (asthma_yes + asthma_no)) %>%
  select(region, age, isWhite, prop_asthma)
rm(as_yes, as_no)

read_csv("./output/cdc_state_covid_age_race_data.csv") %>%
  group_by(region, age) %>%
  filter(!(age %in% c("Under 1 year", "1-4 years", "5-14 years", "15-24 years"))) %>%
  transmute(white_deaths_per_100k =100000.0 * (White) / (Pop_White),
            nonwhite_deaths_per_100k =100000.0 * (`Non-White`) / (`Pop_Non-White`)) %>%
  left_join(prop_met, by = c("region", "age")) %>%
  left_join(prop_urb, by = c("region", "age", "isWhite")) %>%
  left_join(prop_as, by = c("region", "age", "isWhite")) %>%
  left_join(prop_pneu, by = c("region", "age", "isWhite")) %>%
  mutate(deaths_per_100k = if_else(isWhite, white_deaths_per_100k, nonwhite_deaths_per_100k)) %>%
  filter(!is.na(deaths_per_100k)) %>%
  write_csv("./output/state_health.csv") %>%
  transmute(State = paste(toupper(substring(strsplit(region, " ")[[1]], 1, 1)), substring(strsplit(region, " ")[[1]], 2), sep = "", collapse = " "),
            `Age Bracket` = age,
            `Racial Group` = if_else(isWhite, "White", "Not Non-Hispanic White Only"),
            `Deaths per 100,000 Population` = round(deaths_per_100k, 1),
            `Percent Metropolitan` = round(100.0 * prop_metro, 2),
            `Percent Urban` = round(100.0 * prop_urban, 2),
            `Percent Asthma` = round(100.0 * prop_asthma, 2),
            `Percent Pneumonia Vaccine` = round(100.0 * prop_vax, 2)) %>%
  mutate(State = if_else(State == "District Of Columbia", "District of Columbia", State)) %>%
  ungroup() %>%
  select(-region, age) %>%
  write_csv("./output/state_health_trimmed.csv")
  
rm(prop_met, prop_urb, prop_pneu, prop_as, BRFSS)
```

```{r graphVax, include = TRUE, fig.cap = "**Figure:**"}
data <- read_csv("./output/state_health.csv") %>%
  filter(age %in% c("65-74 years", "75-84 years") & !isWhite) %>%
  inner_join(state.regions, by = "region")

old <- paste("Slope: ", signif(summary(lm(prop_vax ~ deaths_per_100k, filter(data, age == "65-74 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(prop_vax ~ deaths_per_100k, filter(data, age == "65-74 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(prop_vax ~ deaths_per_100k, filter(data, age == "65-74 years")))$r.squared, 3), sep = "")
older <- paste("Slope: ", signif(summary(lm(prop_vax ~ deaths_per_100k, filter(data, age == "75-84 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(prop_vax ~ deaths_per_100k, filter(data, age == "75-84 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(prop_vax ~ deaths_per_100k, filter(data, age == "75-84 years")))$r.squared, 3), sep = "")

data <- mutate(data, lab = if_else(age == "65-74 years", old, older), y = if_else(age == "65-74 years", 300, 1100))

ggplot(data, aes(100 * prop_vax, deaths_per_100k)) +
  geom_point(size = 5.25, color = "black") +
  geom_text(label = data$abb, color = "white", size = 2.125, aes(y = deaths_per_100k + 3)) +
  geom_smooth(method = "lm", se = FALSE, size = 1.125, color = "red") +
  facet_grid(age ~ 42, scales = "free") +
  theme_linedraw() +
  theme(panel.grid.major.y  = element_line(size = 1.03125),
        panel.background = element_rect(fill = "#EEEEEE"),
        strip.text.x = element_blank(),
        strip.text.y = element_text(size = 10)) +
  labs(title = "Per Capita COVID Deaths vs Pneumonia Vaccination by State",
       subtitle = "Among Elderly non-White Population",
       x = "Percent Vaccinated against Pneumonia",
       y = "Deaths per 100k Population") +
  geom_label(label = data$lab, aes(85, data$y))
```

Words.

```{r graphAsthma, include = TRUE, fig.cap = "**Figure:**"}
data <- read_csv("./output/state_health.csv") %>%
  filter(age %in% c("65-74 years", "75-84 years") & !isWhite) %>%
  inner_join(state.regions, by = "region")

old <- paste("Slope: ", signif(summary(lm(prop_asthma ~ deaths_per_100k, filter(data, age == "65-74 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(prop_asthma ~ deaths_per_100k, filter(data, age == "65-74 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(prop_asthma ~ deaths_per_100k, filter(data, age == "65-74 years")))$r.squared, 3), sep = "")
older <- paste("Slope: ", signif(summary(lm(prop_asthma ~ deaths_per_100k, filter(data, age == "75-84 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(prop_asthma ~ deaths_per_100k, filter(data, age == "75-84 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(prop_asthma ~ deaths_per_100k, filter(data, age == "75-84 years")))$r.squared, 3), sep = "")

data <- mutate(data, lab = if_else(age == "65-74 years", old, older), y = if_else(age == "65-74 years", 450, 1100))

ggplot(data, aes(100 * prop_asthma, deaths_per_100k)) +
  geom_point(size = 5.25, color = "black") +
  geom_text(label = data$abb, color = "white", size = 2.125, aes(y = deaths_per_100k + 3)) +
  geom_smooth(method = "lm", se = FALSE, size = 1.125, color = "red") +
  facet_grid(age ~ 42, scales = "free") +
  theme_linedraw() +
  theme(panel.grid.major.y  = element_line(size = 1.03125),
        panel.background = element_rect(fill = "#EEEEEE"),
        strip.text.x = element_blank(),
        strip.text.y = element_text(size = 10)) +
  labs(title = "Per Capita COVID Deaths vs Prevalence of Asthma by State",
       subtitle = "Among Elderly non-White Population",
       x = "Percent with Asthma",
       y = "Deaths per 100k Population") +
  geom_label(label = data$lab, aes(35, data$y))
```

Words.

### Metro

Words about metro and suburban.

[Metropolitan Statistical Areas](https://www2.census.gov/geo/maps/metroarea/us_wall/Feb2013/cbsa_us_0213_large.gif)

```{r graphMetro, include = TRUE, fig.cap = "**Figure:**"}
data <- read_csv("./output/state_health.csv") %>%
  filter(!isWhite) %>%
  inner_join(state.regions, by = "region")

younger <- paste("Slope: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "25-34 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(deaths_per_100k ~  prop_metro, filter(data, age == "25-34 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "25-34 years")))$r.squared, 3), sep = "")
young <- paste("Slope: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "35-44 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "35-44 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "35-44 years")))$r.squared, 3), sep = "")
youngish <- paste("Slope: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "45-54 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "45-54 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "45-54 years")))$r.squared, 3), sep = "")
oldish <- paste("Slope: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "55-64 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "55-64 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "55-64 years")))$r.squared, 3), sep = "")
old <- paste("Slope: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "65-74 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "65-74 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "65-74 years")))$r.squared, 3), sep = "")
older <- paste("Slope: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "75-84 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "75-84 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(deaths_per_100k ~ prop_metro, filter(data, age == "75-84 years")))$r.squared, 3), sep = "")

data <- mutate(data, lab = if_else(age == "25-34 years", younger,
                                   if_else(age == "35-44 years", young,
                                           if_else(age == "45-54 years", youngish,
                                                   if_else(age == "55-64 years", oldish,
                                                           if_else(age == "65-74 years", old,
                                                                   older))))),
               y = if_else(age == "25-34 years", 5,
                                   if_else(age == "35-44 years", 20,
                                           if_else(age == "45-54 years", 50,
                                                   if_else(age == "55-64 years", 100,
                                                           if_else(age == "65-74 years", 300,
                                                                   750))))))

ggplot(data, aes(100 * prop_metro, deaths_per_100k)) +
  geom_point(size = 5.25, color = "black") +
  geom_text(label = data$abb, color = "white", size = 2.125, aes(y = deaths_per_100k)) +
  geom_smooth(method = "lm", se = FALSE, size = 1.125, color = "red") +
  facet_grid(age ~ 42, scales = "free") +
  theme_linedraw() +
  theme(panel.grid.major.y = element_line(size = 0.4375),
        panel.grid.minor.y = element_line(size = 0.3125),
        panel.grid.major.x = element_line(size = 0.25),
        panel.grid.minor.x = element_line(size = 0.1875),
        panel.background = element_rect(fill = "#DDDDDD"),
        strip.text.x = element_blank(),
        strip.text.y = element_text(size = 10)) +
  labs(title = "Per Capita COVID Deaths vs\nPopulation in Metropolitan Counties by State",
       subtitle = "Among non-White Population",
       x = "Percent living in Metropolitan Counties",
       y = "Deaths per 100k Population") +
  geom_label(label = data$lab, aes(15, data$y)) +
  ggsave("./figures/state_metro.png", height = 14, width = 7)
```
Words.

```{r graphUrban, include = TRUE, fig.cap = "**Figure:**"}
data <- read_csv("./output/state_health.csv") %>%
  filter(!isWhite) %>%
  inner_join(state.regions, by = "region")

younger <- paste("Slope: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "25-34 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "25-34 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "25-34 years")))$r.squared, 3), sep = "")
young <- paste("Slope: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "35-44 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "35-44 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "35-44 years")))$r.squared, 3), sep = "")
youngish <- paste("Slope: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "45-54 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "45-54 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "45-54 years")))$r.squared, 3), sep = "")
oldish <- paste("Slope: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "55-64 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "55-64 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "55-64 years")))$r.squared, 3), sep = "")
old <- paste("Slope: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "65-74 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "65-74 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "65-74 years")))$r.squared, 3), sep = "")
older <- paste("Slope: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "75-84 years")))[[4]][2, 1], 3),
                           "\np: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "75-84 years")))[[4]][2, 4], 3),
                           "\nr^2: ", signif(summary(lm(prop_urban ~ deaths_per_100k, filter(data, age == "75-84 years")))$r.squared, 3), sep = "")

data <- mutate(data, lab = if_else(age == "25-34 years", younger,
                                   if_else(age == "35-44 years", young,
                                           if_else(age == "45-54 years", youngish,
                                                   if_else(age == "55-64 years", oldish,
                                                           if_else(age == "65-74 years", old,
                                                                   older))))),
               y = if_else(age == "25-34 years", 5,
                                   if_else(age == "35-44 years", 20,
                                           if_else(age == "45-54 years", 50,
                                                   if_else(age == "55-64 years", 100,
                                                           if_else(age == "65-74 years", 300,
                                                                   750))))))

ggplot(data, aes(100 * prop_urban, deaths_per_100k)) +
  geom_point(size = 5.25, color = "black") +
  geom_text(label = data$abb, color = "white", size = 2.125, aes(y = deaths_per_100k)) +
  geom_smooth(method = "lm", se = FALSE, size = 1.125, color = "red") +
  facet_grid(age ~ 42, scales = "free") +
  theme_linedraw() +
  theme(panel.grid.major.y = element_line(size = 0.4375),
        panel.grid.minor.y = element_line(size = 0.3125),
        panel.grid.major.x = element_line(size = 0.25),
        panel.grid.minor.x = element_line(size = 0.1875),
        panel.background = element_rect(fill = "#DDDDDD"),
        strip.text.x = element_blank(),
        strip.text.y = element_text(size = 10)) +
  labs(title = "Per Capita COVID Deaths vs\nPopulation in non-Suburban Metropolitan Counties by State",
       subtitle = "Among non-White Population",
       x = "Percent living in non-Suburban Metropolitan Areas",
       y = "Deaths per 100k Population") +
  geom_label(label = data$lab, aes(15, y)) +
  ggsave("./figures/state_urban.png", height = 14, width = 7)
```

Words.

---

\

## Misc

Here goes all the random little things to look into (Whole Foods, religion, etc.).

\

---

\

## Conclusions

Everything is fine. No bad things have or will happen.

\

---

\

## TODO

Census Region Map
ANOVA
Health Data